---
title: "ÖGD_Netzwerk"
author: "Jakob Schumacher"
date: "24 März 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressWarnings(suppressMessages(library(igraph)))
suppressWarnings(suppressMessages(library(dplyr)))
suppressWarnings(suppressMessages(library(networkD3)))
setwd(here::here())
```


```{r}
nodes <- read.csv("nodes.csv", sep = ",")
nodes$id <- c(0:(nrow(nodes) - 1))
edges <- read.csv("edges_schumacher.csv", sep = ",")

edges <- edges %>% 
  left_join(nodes %>% 
              select(name, id) %>% 
              rename(source = name), by = "source") %>% 
  select(source = id, value, target) %>% 
    left_join(nodes %>% 
              select(name, id) %>% 
              rename(target = name), by = "target") %>% 
  select(source, target = id, value) 

edges <- edges %>% 
  mutate(value = ifelse(value > 4, value, NA)) %>% 
  na.omit()

nodes <- nodes %>% 
  select(id, size, group, fullname )

```


```{r}
oegd_network <- forceNetwork(Links = edges, 
             Nodes = nodes,
            Source = "source", 
            Target = "target",
            Value = "value", 
            NodeID = "fullname",
            Group = "group", 
            fontSize = 50,
            opacity = 0.8,
            linkWidth = JS("function(d) { return d.value/10; }"),
            Nodesize = "size",
            radiusCalculation = "Math.pow(2, d.nodesize)",
            charge = -5000,
            zoom = TRUE)  %>% 
  htmlwidgets::prependContent(htmltools::tags$h1("ÖGD-Netzwerk")) %>% 
  htmlwidgets::prependContent(htmltools::tags$p("Knoten = durch Jakob Schumacher geschätzten Anzahl aller Mitarbeitenden der Einrichtung. Größenformel= 2^10log(Anzahl)")) %>%  
  htmlwidgets::prependContent(htmltools::tags$p("Links = durch Jakob Schumacher geschätzte jährliche Anzahl der Kontakt bei denen eine relevante Information ausgetauscht wird. Größenformel = Anzahl/10")) 

oegd_network

saveNetwork(oegd_network, file = 'index.html')
```
